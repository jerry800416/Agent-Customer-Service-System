# ğŸ§  Agent Assistant API â€“ èª²ç¨‹è«®è©¢æ™ºèƒ½åŠ©ç†ç³»çµ±

é€™æ˜¯ä¸€å¥—åŸºæ–¼ OpenAI Assistant v2 API çš„æ™ºèƒ½åŠ©ç†ç³»çµ±ï¼Œä½¿ç”¨ Flask å»ºç«‹ API serverï¼Œæä¾›ç”¨æˆ¶äº’å‹•å°è©±ã€è‡ªå‹•èª²ç¨‹æ¨è–¦ã€å ±åƒ¹è«®è©¢ã€ä»¥åŠæ½›åœ¨å­¸å“¡è³‡æ–™è’é›†èˆ‡ Airtable å»ºæª”åŠŸèƒ½ã€‚

**å®Œæ•´å®‰è£ä»¥åŠèªªæ˜è«‹åƒé–±ï¼šhttps://jerry800416.medium.com/%E5%A4%A7%E6%A8%A1%E5%9E%8Bllm%E8%90%BD%E5%9C%B0-3-%E8%87%AA%E5%BB%BA%E8%81%8A%E5%A4%A9%E6%A9%9F%E5%99%A8%E4%BA%BA-3d5efb7a0fff**


[toc]


## ğŸ“¦ å°ˆæ¡ˆç‰¹è‰²

* ä½¿ç”¨ OpenAI ç›®å‰å·²é–‹æ”¾æ¨¡å‹ï¼Œæ”¯æ´è§’è‰²è¨­å®šèˆ‡å¤šè¼ªå°è©±
* æ”¯æ´ `file_search` å·¥å…·ï¼Œè‡ªå‹•æŸ¥è©¢çŸ¥è­˜åº«å…§å®¹
* é€é `function calling` è‡ªå‹•å»ºç«‹æ½›åœ¨å®¢æˆ¶è¡¨å–® (`create_lead`)
* ä½¿ç”¨è€…å¯ä¸Šå‚³å¤šä»½çŸ¥è­˜æª”æ¡ˆï¼Œè‡ªå‹•ç¶å®šèˆ‡ Assistant å›ç­”
* æ”¯æ´è‡ªè¨‚è§’è‰²è¨­å®šã€å ±åƒ¹é‚è¼¯èˆ‡è³‡è¨Šå¼•å°ç­–ç•¥
* æ•´åˆ Airtable API å¯«å…¥å­¸å“¡åå–®

## æª”æ¡ˆä»‹ç´¹

```
â”œâ”€Agent                         # âœ… æ™ºèƒ½åŠ©ç†æ ¸å¿ƒé‚è¼¯æ‰€åœ¨è³‡æ–™å¤¾
â”‚  â”œâ”€Knowledge                 # ğŸ“š çŸ¥è­˜åº«è³‡æ–™å¤¾ï¼šæ”¾ç½®ç”¨æ–¼ file_search çš„æ–‡å­—ã€PDF æª”æ¡ˆ
â”‚  â”œâ”€assistant.json            # ğŸ§  å„²å­˜ Assistant ID çš„æœ¬åœ°å¿«å–æª”ï¼Œé¿å…é‡è¤‡å»ºç«‹
â”‚  â”œâ”€functions.py              # ğŸ”§ è‡ªè¨‚å‡½å¼ï¼ˆå¦‚ create_leadï¼‰èˆ‡å»ºç«‹ Assistant çš„æ–¹æ³•
â”‚  â”œâ”€main.py                   # ğŸš€ Flask ä¸»ç¨‹å¼ï¼ŒåŒ…å« API è·¯ç”±ï¼š/startã€/chat ç­‰åŠŸèƒ½
â”‚  â”œâ”€ref.py                    # ğŸ”‘ API é‡‘é‘°èˆ‡è¨­å®šåƒæ•¸ï¼ˆå¦‚ OpenAI keyã€Airtable tokenã€æ¨¡å‹åç¨±ç­‰ï¼‰
â”‚  â””â”€requirements.txt          # ğŸ“¦ Python ç›¸ä¾å¥—ä»¶æ¸…å–®ï¼Œå¯ç”¨ pip install -r å®‰è£
â””â”€WebSite                      # ğŸŒ å‰ç«¯ä»‹é¢æ•´åˆå€
â”‚  â”œâ”€website                 # ğŸ’» ç¶²é å‰ç«¯
â”‚  â””â”€wechat                  # ğŸ“¨ ä»¿å¾®ä¿¡ç¶²é å‰ç«¯
â””â”€advanced-gpt-website-template.vf  # èŠå¤©æ©Ÿå™¨äººå·¥ä½œæµç¨‹æª”æ¡ˆ
```


## ğŸ› ï¸ å®‰è£èˆ‡æº–å‚™

1. å®‰è£å¿…è¦å¥—ä»¶ï¼š

```bash
pip install -r requirements.txtr
```

1. åœ¨ `ref.py` æ–°å¢æ†‘è­‰ï¼š

```python

OPENAI_API_KEY = "sk-..."     # OpenAI é‡‘é‘°
AIRTABLE_TOKEN = "Bearer ..." # Airtable é‡‘é‘°
MODEL = "gpt-4o" # å¯è‡ªè¡Œé¸æ“‡
PROMPTS = """ï¼ˆä½ çš„è§’è‰²è¨­å®šï¼Œå¯è¤‡è£½ pasteï¼‰"""
KNOWLEDGE_BASE = "./knowledge"  # å­˜æ”¾ TXTã€PDF çš„è³‡æ–™å¤¾è·¯å¾‘
```

3. æº–å‚™ä½ çš„çŸ¥è­˜æª”æ¡ˆï¼ˆä¾‹å¦‚ `dige.txt`, `faq.pdf`ï¼‰æ”¾å…¥ `./knowledge` è³‡æ–™å¤¾

4. å»ºç«‹ Assistantï¼ˆæœƒè‡ªå‹•å„²å­˜ `assistant_id` è‡³ `assistant.json`ï¼‰

**å®Œæ•´å®‰è£ä»¥åŠèªªæ˜è«‹åƒé–±ï¼šhttps://jerry800416.medium.com/%E5%A4%A7%E6%A8%A1%E5%9E%8Bllm%E8%90%BD%E5%9C%B0-3-%E8%87%AA%E5%BB%BA%E8%81%8A%E5%A4%A9%E6%A9%9F%E5%99%A8%E4%BA%BA-3d5efb7a0fff**

## ğŸš€ å•Ÿå‹•ä¼ºæœå™¨

```bash
python main.py
```

ä¼ºæœå™¨å°‡å•Ÿå‹•æ–¼ `http://localhost:8080/`

## ğŸ“¡ API è·¯ç”±èªªæ˜

### `GET /start`

* å»ºç«‹æ–°çš„å°è©± thread
* ä¸Šå‚³çŸ¥è­˜åº«ä¸­æ‰€æœ‰æª”æ¡ˆ
* å›å‚³ `thread_id` åŠ `attachments` çµ¦å‰ç«¯ä½¿ç”¨

**å›æ‡‰ç¯„ä¾‹ï¼š**

```json
{
  "thread_id": "thread_xxx",
  "attachments": [
    {
      "file_id": "file-abc123",
      "tools": [{"type": "file_search"}]
    }
  ]
}
```

### `POST /chat`

ä½¿ç”¨è€…å° Assistant ç™¼é€ä¸€å‰‡è¨Šæ¯ã€‚

**Request JSON:**

```json
{
  "thread_id": "thread_xxx",
  "message": "æˆ‘æƒ³å ±åèª²ç¨‹ï¼Œè«‹å•è¦æ€éº¼é–‹å§‹ï¼Ÿ",
  "attachments": [...]  // å¾ /start æ‹¿ä¾†çš„æª”æ¡ˆè³‡è¨Š
}
```

**å›æ‡‰ JSON:**

```json
{
  "response": "è«‹å•æ‚¨çš„å§“åã€è¯çµ¡é›»è©±èˆ‡ Line IDï¼Ÿ"
}
```

## ğŸ§© Assistant è¨­å®šï¼ˆè§’è‰²èˆ‡å·¥å…·ï¼‰

å»ºç«‹ Assistant æ™‚è¨­å®šä»¥ä¸‹é …ç›®ï¼š

### âœ… è§’è‰²ï¼ˆinstructionsï¼‰

```text
ä½ æ˜¯ä¸€ä½ AI èª²ç¨‹å­¸ç¿’è¦åŠƒå°ˆå®¶ï¼Œæœƒæ ¹æ“šä½¿ç”¨è€…çš„åŸå¸‚å ±åƒ¹ä¸¦å¼•å°ç•™ä¸‹è¯çµ¡æ–¹å¼ï¼Œæœ€å¾Œè‡ªå‹•å»ºç«‹è¡¨å–®ã€‚
...
ï¼ˆè©³ç´°è¨­å®šè«‹è¦‹ ref.py çš„ PROMPTS è®Šæ•¸ï¼‰
```

### âœ… å·¥å…·è¨­å®š

* `file_search`ï¼šç”¨æ–¼æ–‡ä»¶æª¢ç´¢
* `create_lead`ï¼šç”¨ä¾†å¯«å…¥ Airtable è¡¨å–®

## ğŸ› ï¸ Function å‘¼å«é‚è¼¯ï¼š`create_lead`

Assistant æ ¹æ“šä½¿ç”¨è€…æä¾›çš„è³‡è¨Šè‡ªå‹•åˆ¤æ–·æ˜¯å¦éœ€è¦å»ºç«‹æ½›åœ¨å®¢æˆ¶è¡¨å–®ï¼Œè§¸ç™¼æ¢ä»¶ç‚ºï¼š

* Assistant æ¨¡å‹è‡ªå‹•æ±ºå®šå‘¼å« `create_lead`
* æœ‰å“ªäº›æ¬„ä½å°±å¯«å…¥å“ªäº›æ¬„ä½ï¼Œæ²’æœ‰çš„ç”¨ç©ºå­—ä¸²è£œé½Š

æ‰€æœ‰æ¬„ä½ï¼š

```json
{
  "name": "ä½¿ç”¨è€…å§“å",
  "phone": "é›»è©±",
  "line": "Line ID",
  "address": "åŸå¸‚/åœ°å€",
  "summary": "æå•æ‘˜è¦",
  "intention": "è³¼è²·æ„é¡˜ï¼ˆå¼·çƒˆ/ä¸€èˆ¬/æš«ä¸è€ƒæ…®ï¼‰"
}
```

## ğŸ“ çŸ¥è­˜åº«è¨­è¨ˆï¼ˆfile\_searchï¼‰

* æ‰€æœ‰æª”æ¡ˆæ”¾åœ¨ `./knowledge/` è³‡æ–™å¤¾
* æª”æ¡ˆæœƒåœ¨ `/start` ä¸­ä¸Šå‚³ä¸¦è½‰æˆ `file_id`
* åœ¨ `/chat` ä¸­ä»¥ `attachments` é™„åŠ é€²æ¯å‰‡è¨Šæ¯ä¸­


## âœ… éŒ¯èª¤è™•ç†è¨­è¨ˆ

* è‡ªå‹•å®¹éŒ¯ missing æ¬„ä½ï¼ˆä½¿ç”¨ `.get(k, "")`ï¼‰
* æª¢æŸ¥ Assistant run çš„ç‹€æ…‹ï¼š`completed` / `requires_action` / `failed`
* è‹¥ç¼ºæ¬„ä½ä¸é˜»æ–·æµç¨‹ï¼Œå…è¨±æŒçºŒæ”¶é›†è³‡æ–™



## âœ… æ¸¬è©¦å»ºè­°è©±è¡“

```text
æˆ‘å«ç‹å°æ˜ï¼Œé›»è©± 0932123456ï¼Œä½é«˜é›„ï¼Œæˆ‘çš„ LINE æ˜¯ @abc123ã€‚
æˆ‘å°èª²ç¨‹å¾ˆæœ‰èˆˆè¶£ï¼Œæƒ³äº†è§£å ±åæµç¨‹èˆ‡åƒ¹æ ¼ã€‚
```

é€™æ¨£æœ€å®¹æ˜“èª˜ç™¼ Assistant å‘¼å« `create_lead` å‡½å¼ã€‚


## çµæœ

![image](https://github.com/jerry800416/Agent-Customer-Service-System/blob/main/Results.gif)